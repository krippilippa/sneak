(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const l of t)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&c(n)}).observe(document,{childList:!0,subtree:!0});function i(t){const l={};return t.integrity&&(l.integrity=t.integrity),t.referrerPolicy&&(l.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?l.credentials="include":t.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function c(t){if(t.ep)return;t.ep=!0;const l=i(t);fetch(t.href,l)}})();const j="modulepreload",I=function(e){return"/sneak/"+e},p={},R=function(o,i,c){let t=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),a=(n==null?void 0:n.nonce)||(n==null?void 0:n.getAttribute("nonce"));t=Promise.allSettled(i.map(s=>{if(s=I(s),s in p)return;p[s]=!0;const h=s.endsWith(".css"),L=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${L}`))return;const d=document.createElement("link");if(d.rel=h?"stylesheet":j,h||(d.as="script"),d.crossOrigin="",d.href=s,a&&d.setAttribute("nonce",a),document.head.appendChild(d),h)return new Promise((S,B)=>{d.addEventListener("load",S),d.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${s}`)))})}))}function l(n){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=n,window.dispatchEvent(a),!a.defaultPrevented)throw n}return t.then(n=>{for(const a of n||[])a.status==="rejected"&&l(a.reason);return o().catch(l)})};let y;if(window.location.href.includes("/sneak/")&&!window.location.href.includes("localhost")){const e=document.createElement("script");e.src="https://download.agora.io/sdk/release/AgoraRTC_N-4.23.2.js",e.async=!1,document.head.appendChild(e),e.onload=()=>{console.log("Agora SDK loaded from CDN"),y=window.AgoraRTC}}else R(()=>import("./AgoraRTC_N-production-BRZS20zp.js").then(e=>e.A),[]).then(e=>{y=e.default,console.log("Agora SDK loaded from npm")});const v=y;let g=null,b=!1,r=null,f=null,u=null,E="fbb5b55989034029abac412d655d05ae",C="test",A=null,m=0;console.log("App ID used:","From environment");console.log("Current base URL: ",window.location.href);function T(){console.log("Waiting for Agora SDK to load...");const e=setInterval(()=>{(window.AgoraRTC||v)&&(clearInterval(e),g=window.AgoraRTC||v,b=!0,console.log("Agora SDK loaded successfully"),V())},100);setTimeout(()=>{b||(clearInterval(e),console.error("Failed to load Agora SDK within timeout period"),alert("Failed to load Agora SDK. Please check your connection and try again."))},1e4)}function P(){if(console.log("Initializing AgoraRTC client"),!g){console.error("AgoraRTC is not loaded");return}r=g.createClient({mode:"live",codec:"vp8",role:"host"}),D()}function D(){console.log("Setting up event listeners"),r.on("user-published",async(e,o)=>{await r.subscribe(e,o),console.log("subscribe success"),o==="video"&&F(e),o==="audio"&&e.audioTrack.play()}),r.on("user-unpublished",async e=>{const o=document.getElementById(e.uid);o&&o.remove()})}async function O(){console.log("Creating local tracks"),f=await g.createMicrophoneAudioTrack(),u=await g.createCameraVideoTrack()}function K(){console.log("Displaying local video");const e=document.createElement("div");e.id=m,e.textContent=`Local user ${m}`,e.style.width="640px",e.style.height="480px",document.body.append(e),u.play(e)}async function _(){console.log("Join as host clicked");try{await r.join(E,C,A,m),console.log("Successfully joined channel as host"),r.setClientRole("host"),await O(),await $(),K(),k(),console.log("Host joined and published tracks.")}catch(e){console.error("Error joining as host:",e)}}async function x(){console.log("Join as audience clicked");try{await r.join(E,C,A,m),console.log("Successfully joined channel as audience");let e={level:2};r.setClientRole("audience",e),k(),console.log("Audience joined.")}catch(e){console.error("Error joining as audience:",e)}}async function $(){console.log("Publishing local tracks"),await r.publish([f,u])}function F(e){console.log("Displaying remote video for user:",e.uid);const o=document.createElement("div");o.id=e.uid.toString(),o.textContent=`Remote user ${e.uid}`,o.style.width="640px",o.style.height="480px",document.body.append(o),e.videoTrack.play(o)}async function H(){console.log("Leave clicked");try{f&&(f.close(),f=null),u&&(u.close(),u=null);const e=document.getElementById(m);e&&e.remove(),r.remoteUsers.forEach(o=>{const i=document.getElementById(o.uid);i&&i.remove()}),await r.leave(),U(),console.log("Left the channel.")}catch(e){console.error("Error leaving channel:",e)}}function k(){document.getElementById("host-join").disabled=!0,document.getElementById("audience-join").disabled=!0}function U(){document.getElementById("host-join").disabled=!1,document.getElementById("audience-join").disabled=!1}function w(){console.log("Setting up button handlers");const e=document.getElementById("host-join"),o=document.getElementById("audience-join"),i=document.getElementById("leave");console.log("Host button found:",!!e),console.log("Audience button found:",!!o),console.log("Leave button found:",!!i),e&&(e.onclick=_),o&&(o.onclick=x),i&&(i.onclick=H),document.addEventListener("click",function(c){c.target&&c.target.id==="host-join"&&console.log("Host button clicked via event listener"),c.target&&c.target.id==="audience-join"&&console.log("Audience button clicked via event listener"),c.target&&c.target.id==="leave"&&console.log("Leave button clicked via event listener")})}function V(){console.log("Starting basic live streaming"),P(),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",w):w()}T();
//# sourceMappingURL=index-CbceglWI.js.map
